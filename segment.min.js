angular.module("ngSegment",[]),angular.module("ngSegment").constant("segmentDefaultConfig",{apiKey:null,autoload:!0,loadDelay:0,condition:null,debug:!1,methods:["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"],tag:"[ngSegment] "}),function(a){function b(){this.load=function(a,b){if(d||window.analytics.initialized)console.warn("Attempting to load Segment twice.");else{if(!a)throw new Error("Cannot load Analytics.js without an API key");d=!0,window.setTimeout(function(){var b=document.createElement("script");b.type="text/javascript",b.async=!0,b.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+a+"/analytics.min.js",b.onerror=function(){console.error("Error loading Segment library.")};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)},b)}}}function c(){b.call(this),this.$get=function(){return new b}}var d=!1;a.provider("segmentLoader",c)}(angular.module("ngSegment")),function(a){function b(a){this.config=a;var b={apiKey:function(){if(!angular.isString(a.apiKey)||!a.apiKey)throw new Error(a.tag+"API key must be a valid string.")},loadDelay:function(){if(!angular.isNumber(a.loadDelay))throw new Error(a.tag+"Load delay must be a number.")}};this.factory=function(a){return function(){return this.config.condition&&!this.config.condition(a,arguments)?void this.debug("Not calling method, condition returned false.",{method:a,arguments:arguments}):(this.debug("Calling method "+a+" with arguments:",arguments),d[a].apply(d,arguments))}.bind(this)},this.validate=function(a){a?b[a]():Object.keys(this.config).forEach(function(a){b[a]()})}}function c(a){b.call(this,angular.copy(a)),this.queue=[],this.factory=function(a){return function(){"function"==typeof this.config.condition?this.queue.push({method:a,arguments:arguments}):this[a].apply(this,arguments)}.bind(this)},this.init(),this.$get=function(a,c){if(a.has("segmentConfig")){var e=a.get("segmentConfig");if(!angular.isObject(e))throw new Error("Config constant must be an object");angular.extend(this.config,e),this.debug("Found segment config constant")}if(this.config.autoload&&(d.initialize&&this.debug("Found analytics.js already present on the page before auto-loading."),this.config.apiKey?(this.debug("Autoloading Analytics.js"),c.load(this.config.apiKey,this.config.loadDelay)):this.debug("Not autoloading Analytics.js, no API key has been set.")),"function"==typeof this.config.condition){var f=this.config.condition;this.config.condition=function(b,c){return a.invoke(f,f,{method:b,params:c})}}var g=new b(this.config);return g.validate(),g.init(),this.queue.forEach(function(a){g[a.method].apply(g,a.arguments)}),g}}var d=window.analytics=window.analytics||[];d.invoked?console.error("Segment or ngSegment included twice."):d.invoked=!0,d.factory=function(a){return function(){var b=Array.prototype.slice.call(arguments);return b.unshift(a),d.push(b),d}},b.prototype={init:function(){for(var a=0;a<this.config.methods.length;a++){var b=this.config.methods[a];d[b]||(d[b]=d.factory(b)),this[b]=this.factory(b)}},debug:function(){this.config.debug&&(arguments[0]=this.config.tag+arguments[0],console.log.apply(console,arguments))},setKey:function(a){return this.config.apiKey=a,this.validate("apiKey"),this},setLoadDelay:function(a){return this.config.loadDelay=a,this.validate("loadDelay"),this},setCondition:function(a){if(!angular.isFunction(a))throw new Error("Condition callback must be a function");return this.config.condition=a,this},setEvents:function(a){return this.events=a,this},setDebug:function(a){return this.config.debug=!!a,this},setConfig:function(a){if(!angular.isObject(a))throw new Error("Config must be an object");return angular.extend(this.config,a),this},setAutoload:function(a){return this.config.autoload=!!a,this}},c.prototype=Object.create(b.prototype),a.provider("segment",["segmentDefaultConfig",c])}(angular.module("ngSegment"));